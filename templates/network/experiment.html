{% extends 'base.html' %}

{% block content %}

<div class="container">
    <h3>{{experiment.name}}</h3>
    <div class="row">
        <div class="col-sm-8">
            {% if experiment.data_type %}
            <p>Data type: {{experiment.data_type}}</p>
            {% endif %}

            {% if experiment.cell_type %}
            <p>Cell type: {{experiment.cell_type}}</p>
            {% endif %}

            {% if experiment.target %}
            <p>Antibody: {{experiment.target}}</p>
            {% endif %}

            {% if experiment.description %}
            <p>Description: {{experiment.description|linebreaks}}</p>
            {% endif %}
        </div>
        <div class="col-sm-4">
            <a href="{% url 'similar_experiments' pk=experiment.pk %}" class="btn btn-primary btn-block">Similar experiments</a>
        </div>
    </div>

    <div class="row">
        <div class="col-sm-6">
            <h4 align="center">Promoters</h4>
            <div id="meta1"></div>
        </div>
        <div class="col-sm-6">
            <h4 align="center">Enhancers</h4>
            <div id="meta2"></div>
        </div>
    </div>
    <div id="browser"/>
</div>

{% endblock content %}

{% block extra-js %}
<script type='text/javascript'>
var assembly_name = Object.keys({{display_data.plot_data|safe}})[0];
var display_data = {{display_data|safe}};
for (var i = 0; i < display_data['plot_data'].length; i++) {
    if (display_data['plot_data'][i]['regions'] == 'Promoters') {
        var promoter_metaplot = display_data['plot_data'][i]['metaplot'];
    } else if (display_data['plot_data'][i]['regions'] == 'Enhancers') {
        var enhancer_metaplot = display_data['plot_data'][i]['metaplot'];
    }
}
$(document).ready(function(){
    window.apps.createMetaPlot(
        $('#meta1')[0],
        promoter_metaplot
    );
    window.apps.createMetaPlot(
        $('#meta2')[0],
        enhancer_metaplot
    );
    window.apps.createBrowser(
        $('#browser')[0],
        {{experiment.id}},
        '{{dataset.assembly}}',
        200,
        $('#browser').width(),
        {{selectable|safe}}
    );
});
</script>
{% endblock %}
